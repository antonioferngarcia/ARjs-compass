
<html>
<head>
  <title>AR.js A-Frame Compass</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js'></script>
  <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js'></script>
  <style>
    #compass-img {
      position: fixed;
      bottom: calc(50% - 50px);
      left: calc(50% - 50px);
      width: 100px;
      height: 100px;
      z-index: 1000; /* Ensure it is on top of other elements */
    }
  </style>
  <script>

    AFRAME.registerComponent('ring-text', {
      init: function () {
        // Create the ring
        var ring0 = document.createElement('a-entity');
        ring0.setAttribute('geometry', {
          primitive: 'ring',
          radiusInner: 0.9,
          radiusOuter: 1
        });
        ring0.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        ring0.setAttribute('rotation', '90 0 0');
        ring0.setAttribute('position', '0 1.65 0');

        var ring15 = document.createElement('a-entity');
        ring15.setAttribute('geometry', {
          primitive: 'ring',
          radiusInner: 0.98,
          radiusOuter: 1
        });
        ring15.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        ring15.setAttribute('rotation', '90 0 0');
        ring15.setAttribute('position', '0 1.921 0');

        var ring30 = document.createElement('a-entity');
        ring30.setAttribute('geometry', {
          primitive: 'ring',
          radiusInner: 0.98,
          radiusOuter: 1
        });
        ring30.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        ring30.setAttribute('rotation', '90 0 0');
        ring30.setAttribute('position', '0 2.23 0');

        var ring45 = document.createElement('a-entity');
        ring45.setAttribute('geometry', {
          primitive: 'ring',
          radiusInner: 0.98,
          radiusOuter: 1
        });
        ring45.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        ring45.setAttribute('rotation', '90 0 0');
        ring45.setAttribute('position', '0 2.665 0');

        var ring60 = document.createElement('a-entity');
        ring60.setAttribute('geometry', {
          primitive: 'ring',
          radiusInner: 0.98,
          radiusOuter: 1
        });
        ring60.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        ring60.setAttribute('rotation', '90 0 0');
        ring60.setAttribute('position', '0 3.4 0');

        var ring75 = document.createElement('a-entity');
        ring75.setAttribute('geometry', {
          primitive: 'ring',
          radiusInner: 0.98,
          radiusOuter: 1
        });
        ring75.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        ring75.setAttribute('rotation', '90 0 0');
        ring75.setAttribute('position', '0 5.5 0');

        var arcEW = document.createElement('a-entity');
        arcEW.setAttribute('geometry', {
          primitive: 'cylinder',
          height: 0.01,
          radius: 1,
          thetaLength: 180,
          thetaStart: 0,
          // radiusTop: 10,
          // radiusBottom: 10,
          openEnded: true
        });
        arcEW.setAttribute('material', {
          color: 'blue',
          side: 'double'
        });
        arcEW.setAttribute('rotation', '0 90 90');
        arcEW.setAttribute('position', '0 1.65 0');

        var arcNS = document.createElement('a-entity');
        arcNS.setAttribute('geometry', {
          primitive: 'cylinder',
          height: 0.01,
          radius: 1,
          thetaLength: 180,
          thetaStart: 0,
          // radiusTop: 10,
          // radiusBottom: 10,
          openEnded: true
        });
        arcNS.setAttribute('material', {
          color: 'blue',
          side: 'double'
        });
        arcNS.setAttribute('rotation', '0 0 90');
        arcNS.setAttribute('position', '0 1.65 0');

        var arc30_210 = document.createElement('a-entity');
        arc30_210.setAttribute('geometry', {
          primitive: 'cylinder',
          height: 0.01,
          radius: 1,
          thetaLength: 180,
          thetaStart: 0,
          openEnded: true
        });
        arc30_210.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        arc30_210.setAttribute('rotation', '0 30 90');
        arc30_210.setAttribute('position', '0 1.65 0');

        var arc60_240 = document.createElement('a-entity');
        arc60_240.setAttribute('geometry', {
          primitive: 'cylinder',
          height: 0.01,
          radius: 1,
          thetaLength: 180,
          thetaStart: 0,
          openEnded: true
        });
        arc60_240.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        arc60_240.setAttribute('rotation', '0 60 90');
        arc60_240.setAttribute('position', '0 1.65 0');

        var arc120_300 = document.createElement('a-entity');
        arc120_300.setAttribute('geometry', {
          primitive: 'cylinder',
          height: 0.01,
          radius: 1,
          thetaLength: 180,
          thetaStart: 0,
          openEnded: true
        });
        arc120_300.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        arc120_300.setAttribute('rotation', '0 120 90');
        arc120_300.setAttribute('position', '0 1.65 0');

        var arc150_330 = document.createElement('a-entity');
        arc150_330.setAttribute('geometry', {
          primitive: 'cylinder',
          height: 0.01,
          radius: 1,
          thetaLength: 180,
          thetaStart: 0,
          openEnded: true
        });
        arc150_330.setAttribute('material', {
          color: 'red',
          side: 'double'
        });
        arc150_330.setAttribute('rotation', '0 150 90');
        arc150_330.setAttribute('position', '0 1.65 0');

        // Create the northtext
        var northText = document.createElement('a-text');
        northText.setAttribute('value', 'N');
        northText.setAttribute('color', 'red');
        northText.setAttribute('color', 'red');
        northText.setAttribute('position', '0 2 -5');

        // Create the southtext
        var southText = document.createElement('a-text');
        southText.setAttribute('value', 'S');
        southText.setAttribute('color', 'blue');
        southText.setAttribute('position', '0 2 5');
        southText.setAttribute('rotation', '0 180 0');
        southText.setAttribute('look-at', '#camera'); // Make the text look at the camera

        var eastText = document.createElement('a-text');
        eastText.setAttribute('value', 'E');
        eastText.setAttribute('color', 'blue');
        eastText.setAttribute('position', '5 2 0');
        eastText.setAttribute('rotation', '0 270 0');
        eastText.setAttribute('look-at', '#camera'); // Make the text look at the camera

        var westText = document.createElement('a-text');
        westText.setAttribute('value', 'O');
        westText.setAttribute('color', 'blue');
        westText.setAttribute('position', '-5 2 0');
        westText.setAttribute('rotation', '0 90 0');
        westText.setAttribute('look-at', '#camera'); // Make the text look at the camera

        // Append the ring and text to the component
        this.el.appendChild(ring0);
        this.el.appendChild(ring15);
        this.el.appendChild(ring30);
        this.el.appendChild(ring45);
        this.el.appendChild(ring60);
        this.el.appendChild(ring75);
        this.el.appendChild(arcNS);
        this.el.appendChild(arc30_210);
        this.el.appendChild(arc60_240);
        this.el.appendChild(arcEW);
        this.el.appendChild(arc120_300);
        this.el.appendChild(arc150_330);
        this.el.appendChild(northText);
        this.el.appendChild(southText);
        this.el.appendChild(eastText);
        this.el.appendChild(westText);
      }
    });
  </script>
</head>
<body>
<a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: true' renderer='antialias: true; alpha: true'>
  <a-camera id="camera" position="0 1.6 0"></a-camera>
  <a-entity id="ring-text" ring-text></a-entity>
</a-scene>
<img id="compass-img" src="public/compass.png" alt="Compass">

</body>
<script>
  function rotateCompass(eventData) {
    var dir = eventData.alpha +180;
    var compassCone = document.querySelector('#compass-img');
    compassCone.style.transform = 'rotate(' + dir + 'deg)';
  }

  function rotateRing(eventData) {
    var dir = Math.ceil(eventData.alpha)
    const angle = dir < 0 ? 360 + dir : dir
    const rotation = '0 '+angle+' 0'
    var ringText = document.querySelector('#ring-text');
    ringText.setAttribute('rotation', rotation);
    console.log('Rotation: ', rotation)
  }

  (function () {
    let ringRotationDone = false

    window.addEventListener('deviceorientation', function (eventData) {
      rotateCompass(eventData)
      if(!ringRotationDone) {
        rotateRing(eventData)
        ringRotationDone = true
      }
    }, false);
  })()
</script>
</html>
